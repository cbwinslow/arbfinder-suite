# Cloudflare Workers configuration for ArbFinder Suite

name = "arbfinder-worker"
main = "src/index.ts"
compatibility_date = "2024-01-01"
node_compat = true

[env.production]
name = "arbfinder-worker-production"
route = "arbfinder.com/*"

[env.staging]
name = "arbfinder-worker-staging"
route = "staging.arbfinder.com/*"

# R2 bucket bindings
[[r2_buckets]]
binding = "IMAGES"
bucket_name = "arbfinder-images"
preview_bucket_name = "arbfinder-images-preview"

[[r2_buckets]]
binding = "DATA"
bucket_name = "arbfinder-data"
preview_bucket_name = "arbfinder-data-preview"

# KV namespaces for caching
[[kv_namespaces]]
binding = "CACHE"
id = "your-kv-namespace-id"
preview_id = "your-preview-kv-namespace-id"

# Environment variables
[vars]
API_BASE_URL = "https://api.arbfinder.com"
ENVIRONMENT = "production"

# Durable Objects for stateful operations
[[durable_objects.bindings]]
name = "CRAWLER_STATE"
class_name = "CrawlerState"
script_name = "arbfinder-worker"

# Cron triggers for scheduled tasks
[triggers]
crons = [
  "0 */4 * * *",  # Run crawler every 4 hours
  "*/15 * * * *"  # Process metadata queue every 15 minutes
]

# Build configuration
[build]
command = "npm run build"
[build.upload]
format = "service-worker"
